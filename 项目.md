# 项目

````xml
myBatis默认开启一级缓存，一级缓存是会话内部的缓存，如果有另一个会话修改了数据，再次读取会导致读脏数据的问题。
````

Rabbit MQ `backNack` 死循环

```java
 if (action == Action.SUCCESS) {
     //multiple 表示是否批量处理。true表示批量ack处理小于tag的所有消息。false则处理当前消息
      channel.basicAck(tag, false);
 } else if (action == Action.RETRY) {
     //Nack，拒绝策略，消息重回队列
     channel.basicNack(tag, false, true);
 } else {
     //Nack，拒绝策略，并且从队列中删除
     channel.basicNack(tag, false, false);
}
```

没有被正确消费的消息,，如果被设置重新放回队列，导致一条“坏”消息反复被消费又被放回。

解决方案：

1. **当消费失败后将此消息存到 Redis，记录消费次数，如果消费了三次还是失败，就丢弃掉消息，记录日志落库保存**

2. **直接填 false ，不重回队列，记录日志、发送邮件等待开发手动处理**

3. **不启用手动 ack ，使用 SpringBoot 提供的消息重试**