## Nagle算法

TCP的数据流大致可以分为两类，交互数据流与成块的数据流。交互数据流就是发送控制命令的数据流，比如`relogin`，`telnet`，`ftp`命令等等；成块数据流是用来发送数据的包，网络上大部分的TCP包都是这种包。很明显，TCP在传输这两种类型的包时的效率是不一样的，因此为了提高TCP的传输效率，应该对这两种类型的包采用不同的算法。总之，TCP的传输原则是尽量减少小分组传输的数量。 

### Nagle算法分析

Nagle时针对每一个TCP连接的。它要求一个TCP连接上最多只能有一个未被确认的小分组。在改分组的确认到达之前不能发送其他小分组。TCP会搜集这些小的分组，然后在之前小分组的确认到达后将刚才搜集的小分组合并发送出去。

```java
if 有数据要发送：

if 可用窗口大小 >= MSS and 可发送的数据 >= MSS：

立刻发送MSS大小的数据

else ：

if 有未确认的数据：

将数据放入缓存等待接收ACK

else：

立刻发送数据
```

有时候我们必须要关闭Nagle算法，特别是在一些对时延要求较高的交互式操作环境中，所有的小分组必须尽快发送出去。

我们可以通过编程取消Nagle算法，利用TCP_NODELAY选项来关闭Nagle算法。