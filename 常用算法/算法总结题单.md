# 算法题单

# 单调栈

基本特征是：求某个元素附近最大/最小的元素，问题也会和左右元素形成的区间有关。

个人总结：

题目常以一个数组做输入，通常需要遍历数组进行某种与附近（这个附近定义通常与局部的单调性有关）元素相关的操作，且只要复杂度超过`O(nlogn)`就会超时，所以不得不在遍历过程中记录关键数据（通常是区间上的最值），此时O(1)的空间复杂度常常难以完成。

| 题目链接                                                     | 特点                                          |
| ------------------------------------------------------------ | --------------------------------------------- |
| [剑指 Offer 30. 包含min函数的栈](https://leetcode.cn/problems/bao-han-minhan-shu-de-zhan-lcof/) | 经典单调栈                                    |
| [739.每日温度](https://leetcode.cn/problems/daily-temperatures/) | 存下标是一种很常见的做法。                    |
| [901. 股票价格跨度](https://leetcode.cn/problems/online-stock-span/) | 同上                                          |
| [496. 下一个更大元素 I](https://leetcode.cn/problems/next-greater-element-i/) | 打破单调栈题目中只有一个数组的思维惯性。      |
| [503. 下一个更大元素 II](https://leetcode.cn/problems/next-greater-element-ii/) | 需要额外解决循环数组的问题。                  |
| [239. 滑动窗口最大值](https://leetcode.cn/problems/sliding-window-maximum/) | 使用双端队列维护单调性，是最小/大栈的进阶题目 |
| [581. 最短无序连续子数组](https://leetcode-cn.com/problems/shortest-unsorted-continuous-subarray/) | 利用出栈的意义解题，出栈即意味着不满足单调性  |
| [剑指 Offer 33. 二叉搜索树的后序遍历序列](https://leetcode.cn/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/) | 利用出栈操作                                  |
| [42. 接雨水](https://leetcode.cn/problems/trapping-rain-water/) | 利用出栈操作+区间计算                         |
| [84. 柱状图中最大的矩形](https://leetcode.cn/problems/largest-rectangle-in-histogram/) | 区间计算                                      |

建议顺序：739, 901 => 496、503、 239 => 剑指 33 、581 => 84 => 42

## 基础模板：

```java
 public int[] nextGreaterNum(int[] nums) {
        Deque<Integer> stack = new LinkedList<>();
        int n = nums.length;
        int[] ans = new int[n];
        for(int i=n-1; i>=0; i--){
            while(!stack.isEmpty() && stack.peek() <= nums[i]){
                stack.pop();
            }
            // 此时栈为空代表没有更大元素
            ans[i] = stack.isEmpty() ? -1 : stack.peek();
            stack.push(nums[i]);
        }
        return ans;
    }
```

|
|

基础题：[剑指 Offer 30. 包含min函数的栈](https://leetcode.cn/problems/bao-han-minhan-shu-de-zhan-lcof/)，面试典中典，必做问题，对理解最小栈的意义很有必要。进阶题目[239. 滑动窗口最大值](https://leetcode.cn/problems/sliding-window-maximum/)。

## 进阶题目

### 一、 辅助栈中存下标

- [739.每日温度](https://leetcode.cn/problems/daily-temperatures/)
- [901. 股票价格跨度](https://leetcode.cn/problems/online-stock-span/)

单调栈的第一个变式，在栈中保存下标而不是元素本身，这种变化在题目中很常见，需要优先熟悉。

签名介绍的单调栈模板更加符合直觉，即栈中的元素是符合单调性的。但是题目常常用到下标来计算，所以很多情况下在辅助栈中直接存储下标，这是单调栈实践的第一个坎。很多题目还需要配合哨兵节点来解决一些特殊用例，如[581. 最短无序连续子数组](https://leetcode-cn.com/problems/shortest-unsorted-continuous-subarray/)。

### 二、一个栈 + 一个数组

- [496. 下一个更大元素 I](https://leetcode.cn/problems/next-greater-element-i/)
- [503. 下一个更大元素 II](https://leetcode.cn/problems/next-greater-element-ii/)
- [239. 滑动窗口最大值](https://leetcode.cn/problems/sliding-window-maximum/)

单调栈通常只对一个数组进行操作，模板较为简单。在练习单调栈题目时，不小心就把模板背熟了，但可能对单调栈的理解还差很远。读者可以尝试做这两道题，看看自己理解是否透彻。

前两道题只是数组形式上的变化，本质上还是对一个数组的操作。

第三题使用双端队列维护单调性，其变化在于滑动窗口，是最小栈/最大栈问题的进阶版，值得一练。

### 三、利用出栈操作

单调性常常作为题目的题眼所在，单调栈在这类题目上有很大的作用。

因为，单调栈中的元素代表了单调的元素，而被出栈的元素自然是打破了单调性的元素，这在题目背景中常常有特殊意义。

比如：

[581. 最短无序连续子数组](https://leetcode-cn.com/problems/shortest-unsorted-continuous-subarray/)：如果序列递增被打破，说明当前元素属于乱序部分。

[42. 接雨水](https://leetcode.cn/problems/trapping-rain-water/)：如果序列递减被打破，代表需要开始计算积水量了。[相关题解](https://leetcode.cn/problems/trapping-rain-water/solution/trapping-rain-water-by-ikaruga/)

[剑指 Offer 33. 二叉搜索树的后序遍历序列](https://leetcode.cn/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/)：这一题反映了二叉搜索树的后序遍历规律，即一个后续遍历序列的根节点一定在在节点右边，而在二叉搜索树中，这代表第一个比某数大数在该数右边。[相关题解](https://leetcode.cn/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/solution/mian-shi-ti-33-er-cha-sou-suo-shu-de-hou-xu-bian-6/)

具体应用方法肯定变化多样，但是单调栈在其中都起到了两种作用：

1. 存储值，用以检测单调性，这是O(1)的空间复杂度很难做到的。
2. 弹出值，用以计算核心问题

**理解了以上两点后，就可以挑战最后的区间问题了。**

### 四、区间问题

- [42. 接雨水](https://leetcode.cn/problems/trapping-rain-water/)
- [84. 柱状图中最大的矩形](https://leetcode.cn/problems/largest-rectangle-in-histogram/)

这种题目将上面的1、3结合起来，问题一般是对每个元素的枚举才能得到，例如42题，求总积水量，84题求最值。

而想要枚举出的子问题，必须根据附近的区间来决定，例如42题，一个先递减到递增才会存水，84题（根据高度枚举）要将左右不低于当前值的值计算进来。